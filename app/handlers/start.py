from aiogram import Dispatcher
from aiogram.types import Message
from aiogram.filters import Command

from app.logger import setup_logger

logger = setup_logger(__name__)


async def start_command(message: Message) -> None:
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É /start
    - –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–≥—Ä–æ–∫–µ.
    - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.

    :param message: –û–±—ä–µ–∫—Ç –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    """
    logger.info(f"üëã –ò–≥—Ä–æ–∫ @{message.from_user.username} –∑–∞–ø—É—Å—Ç–∏–ª –±–æ—Ç–∞!")

    # with db_session() as db:
    #     register_or_update_player(db, telegram_id=str(message.from_user.id), username=message.from_user.username)

    await message.answer("–ü—Ä–∏–≤–µ—Ç!")


def register_handler(dp: Dispatcher) -> None:
    """
    –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ –∫–Ω–æ–ø–æ–∫:
    - /start ‚Äî –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
    - 'üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é' ‚Äî –≤–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    - 'üöì –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã' ‚Äî –ø–æ–∫–∞–∑ –ø—Ä–∞–≤–∏–ª –∏–≥—Ä—ã

    :param dp: –û–±—ä–µ–∫—Ç –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ aiogram.
    """
    dp.message.register(start_command, Command("start"))
